{template '_header'}
<style>
	.dn{
		display: none
	}
    tbody tr td{
        position: relative;
    }
    tbody tr  .icow-weibiaoti--{
        visibility: hidden;
        display: inline-block;
        color: #fff;
        height:18px;
        width:18px;
        background: #e0e0e0;
        text-align: center;
        line-height: 18px;
        vertical-align: middle;
    }
    tbody tr:hover .icow-weibiaoti--{
        visibility: visible;
    }
    tbody tr  .icow-weibiaoti--.hidden{
        visibility: hidden !important;
    }
    .full .icow-weibiaoti--{
        margin-left:10px;
    }
    .full>span{
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
        vertical-align: middle;
        align-items: center;
    }
    tbody tr .label{
        margin: 5px 0;
    }
    .goods_attribute a{
        cursor: pointer;
    }
    .newgoodsflag{
        width: 22px;height: 16px;
        background-color: #ff0000;
        color: #fff;
        text-align: center;
        position: absolute;
        bottom: 70px;
        left: 57px;
        font-size: 12px;
    }
    .modal-dialog {
        min-width: 720px !important;
        position: absolute;
        left: 0;
        right: 0;
        top: 50%;
    }
    .catetag{
        overflow:hidden;

        text-overflow:ellipsis;

        display:-webkit-box;

        -webkit-box-orient:vertical;

        -webkit-line-clamp:2;
    }
</style>
<div class="page-header">
    当前位置：<span class="text-primary">商品管理</span>
</div>
<div class="page-content">
    <div class="fixed-header">
        <div style="width:25px;"></div>
        <div style="width:80px;text-align:center;">排序</div>
        <div style="width:80px;">商品</div>
        <div class="flex1">&nbsp;</div>
        <div style="width: 100px;">价格</div>
        <div style="width: 80px;">库存</div>
        <div style="width: 80px;">销量</div>
        <div style="width: 80px;">实际销量</div>
        {if $goodsfrom!='cycle'}
        <div  style="width:80px;" >状态</div>
        {/if}
        <div class="flex1">属性</div>
        <div style="width: 120px;">操作</div>
    </div>
    <form action="./index.php" method="get" class="form-horizontal form-search" role="form">
        <input type="hidden" name="c" value="site" />
        <input type="hidden" name="a" value="entry" />
        <input type="hidden" name="m" value="ewei_shopv2" />
        <input type="hidden" name="do" value="web" />
        <input type="hidden" name="r"  value="goods.albb" />
        <div class="page-toolbar">

            <div class="input-group col-sm-12 pull-right">

                <span class="input-group-select">
                    <select name="biztype" class='form-control select2' style="width:100px;" data-placeholder="经营模式">
                        <option value="" {if empty($_GPC['biztype'])}selected{/if}>经营模式</option>
                        <option value="1" {if $_GPC['biztype'] == 1}selected{/if}>生产加工</option>
                        <option value="2" {if $_GPC['biztype'] == 2}selected{/if}>经销批发</option>
                        <option value="3" {if $_GPC['biztype'] == 3}selected{/if}>招商代理</option>
                        <option value="4" {if $_GPC['biztype'] == 4}selected{/if}>商业服务</option>
                    </select>
                </span>
                <span class="input-group-select">
                    <select name="buyerProtection" class='form-control select2' style="width:100px;" data-placeholder="买家保障">
                        <option value="" {if empty($_GPC['buyerProtection'])}selected{/if}>买家保障</option>
                        <option value="qtbh" {if $_GPC['buyerProtection'] == qtbh}selected{/if}>7天包换</option>
                        <option value="swtbh" {if $_GPC['buyerProtection'] == swtbh}selected{/if}>15天包换</option>
                    </select>
                </span>
                <span class="input-group-select">
                    <select name="deliveryTimeType" class='form-control select2' style="width:100px;" data-placeholder="发货时间">
                        <option value="" {if empty($_GPC['deliveryTimeType'])}selected{/if}>发货时间</option>
                        <option value="1" {if $_GPC['deliveryTimeType'] == 1}selected{/if}>24小时发货</option>
                        <option value="2" {if $_GPC['deliveryTimeType'] == 2}selected{/if}>48小时发货</option>
                        <option value="3" {if $_GPC['deliveryTimeType'] == 3}selected{/if}>72小时发货</option>
                    </select>
                </span>

                <span class="input-group-select">
                    <select name="postCategoryId" class='form-control select2' style="width:100px;" data-placeholder="类目">
                        <option value="" {if empty($_GPC['postCategoryId'])}selected{/if}>类目</option>
                        <option value="4" {if $_GPC['postCategoryId'] == 4}selected{/if}>纺织、皮革</option>
                        <option value="5" {if $_GPC['postCategoryId'] == 5}selected{/if}>电工电气</option>
                        <option value="10" {if $_GPC['postCategoryId'] == 10}selected{/if}>能源</option>
                        <option value="12" {if $_GPC['postCategoryId'] == 12}selected{/if}>交通运输</option>
                        <option value="16" {if $_GPC['postCategoryId'] == 16}selected{/if}>医药、保养</option>
                        <option value="17" {if $_GPC['postCategoryId'] == 17}selected{/if}>工艺品、礼品</option>
                        <option value="57" {if $_GPC['postCategoryId'] == 57}selected{/if}>电子元器件</option>
                        <option value="58" {if $_GPC['postCategoryId'] == 58}selected{/if}>照明工业</option>
                        <option value="64" {if $_GPC['postCategoryId'] == 64}selected{/if}>环保</option>
                        <option value="66" {if $_GPC['postCategoryId'] == 66}selected{/if}>医药、保养</option>
                        <option value="67" {if $_GPC['postCategoryId'] == 67}selected{/if}>办公、文教</option>
                        <option value="69" {if $_GPC['postCategoryId'] == 69}selected{/if}>商务服务</option>
                        <option value="96" {if $_GPC['postCategoryId'] == 96}selected{/if}>家纺家饰</option>
                        <option value="311" {if $_GPC['postCategoryId'] == 311}selected{/if}>童装</option>
                        <option value="312" {if $_GPC['postCategoryId'] == 312}selected{/if}>内衣</option>
                        <option value="1813" {if $_GPC['postCategoryId'] == 1813}selected{/if}>玩具</option>
                        <option value="2805" {if $_GPC['postCategoryId'] == 2805}selected{/if}>加工</option>
                        <option value="2829" {if $_GPC['postCategoryId'] == 2829}selected{/if}>二手设备转让</option>
                        <option value="10165" {if $_GPC['postCategoryId'] == 10165}selected{/if}>男装</option>
                        <option value="1038378" {if $_GPC['postCategoryId'] == 1038378}selected{/if}>鞋</option>
                        <option value="1042954" {if $_GPC['postCategoryId'] == 1042954}selected{/if}>箱包皮具</option>
                        <option value="127380009" {if $_GPC['postCategoryId'] == 127380009}selected{/if}>运动服饰</option>
                        <option value="130822002" {if $_GPC['postCategoryId'] == 130822002}selected{/if}>餐饮生鲜</option>
                        <option value="130823000" {if $_GPC['postCategoryId'] == 130823000}selected{/if}>性保健品</option>
                        <option value="200514001" {if $_GPC['postCategoryId'] == 200514001}selected{/if}>床上用品</option>
                        <option value="201128501" {if $_GPC['postCategoryId'] == 201128501}selected{/if}>直播</option>
                        <option value="1" {if $_GPC['postCategoryId'] == 1}selected{/if}>农业</option>
                        <option value="2" {if $_GPC['postCategoryId'] == 2}selected{/if}>食品酒水</option>
                        <option value="7" {if $_GPC['postCategoryId'] == 7}selected{/if}>数码、电脑</option>
                        <option value="9" {if $_GPC['postCategoryId'] == 9}selected{/if}>冶金矿产</option>
                        <option value="15" {if $_GPC['postCategoryId'] == 15}selected{/if}>日用百货</option>
                        <option value="18" {if $_GPC['postCategoryId'] == 18}selected{/if}>运动装备</option>
                        <option value="33" {if $_GPC['postCategoryId'] == 33}selected{/if}>汽摩及配件</option>
                        <option value="53" {if $_GPC['postCategoryId'] == 53}selected{/if}>传媒、广电</option>
                        <option value="54" {if $_GPC['postCategoryId'] == 54}selected{/if}>服饰配件、饰品</option>
                        <option value="59" {if $_GPC['postCategoryId'] == 59}selected{/if}>五金、工具</option>
                        <option value="68" {if $_GPC['postCategoryId'] == 68}selected{/if}>包装</option>
                        <option value="70" {if $_GPC['postCategoryId'] == 70}selected{/if}>安全、防护</option>
                        <option value="96" {if $_GPC['postCategoryId'] == 96}selected{/if}>美妆日化</option>
                        <option value="97" {if $_GPC['postCategoryId'] == 97}selected{/if}>美容护肤/彩妆</option>
                        <option value="1501" {if $_GPC['postCategoryId'] == 1501}selected{/if}>母婴用品</option>
                        <option value="10166" {if $_GPC['postCategoryId'] == 10166}selected{/if}>女装</option>
                        <option value="10208" {if $_GPC['postCategoryId'] == 10208}selected{/if}>仪器仪表</option>
                        <option value="122916001" {if $_GPC['postCategoryId'] == 122916001}selected{/if}>宠物及园艺</option>
                        <option value="123614001" {if $_GPC['postCategoryId'] == 123614001}selected{/if}>钢铁</option>
                        <option value="130822220" {if $_GPC['postCategoryId'] == 130822220}selected{/if}>个护/家清</option>
                        <option value="6" {if $_GPC['postCategoryId'] == 6}selected{/if}>家用电器</option>
                        <option value="8" {if $_GPC['postCategoryId'] == 8}selected{/if}>化工</option>
                        <option value="13" {if $_GPC['postCategoryId'] == 13}selected{/if}>家装、建材</option>
                        <option value="21" {if $_GPC['postCategoryId'] == 21}selected{/if}>办公、文教</option>
                        <option value="55" {if $_GPC['postCategoryId'] == 55}selected{/if}>橡塑</option>
                        <option value="65" {if $_GPC['postCategoryId'] == 65}selected{/if}>机械及行业设备</option>
                        <option value="71" {if $_GPC['postCategoryId'] == 71}selected{/if}>汽摩及配件</option>
                        <option value="72" {if $_GPC['postCategoryId'] == 72}selected{/if}>印刷</option>
                        <option value="73" {if $_GPC['postCategoryId'] == 73}selected{/if}>项目合作</option>
                        <option value="509" {if $_GPC['postCategoryId'] == 509}selected{/if}>通信产品</option>
                        <option value="1426" {if $_GPC['postCategoryId'] == 1426}selected{/if}>机床</option>
                        <option value="1043472" {if $_GPC['postCategoryId'] == 1043472}selected{/if}>毛巾、巾类</option>
                        <option value="122916002" {if $_GPC['postCategoryId'] == 122916002}selected{/if}>汽车用品</option>
                    </select>
                </span>

                <span class="input-group-select">
                    <select name="priceFilterFields" class='form-control select2' style="width:100px;" data-placeholder="价格类型">
                        <option value="" {if empty($_GPC['priceFilterFields'])}selected{/if}>价格类型</option>
                        <option value="agent_price" {if $_GPC['priceFilterFields'] == 'agent_price'}selected{/if}>分销价</option>
                        <option value="superBuyerPrice" {if $_GPC['priceFilterFields'] == 'superBuyerPrice'}selected{/if}>超买价</option>
                    </select>
                </span>

                <span class="input-group-select">
                    <select name="tags" class='form-control select2' style="width:100px;" data-placeholder="价格类型">
                        <option value="" {if empty($_GPC['tags'])}selected{/if}>价格类型</option>
                        <option value="263106" {if $_GPC['tags'] == 263106}selected{/if}>S级商品标</option>
                        <option value="264898" {if $_GPC['tags'] == 264898}selected{/if}>A级商品标</option>
                        <option value="266818" {if $_GPC['tags'] == 266818}selected{/if}>B级商品标</option>
                        <option value="268866" {if $_GPC['tags'] == 268866}selected{/if}>C级商品标</option>
                    </select>
                </span>
                <span class="input-group-select">
                    <select name="offerTags" class='form-control select2' style="width:100px;" data-placeholder="选择货源">
                        <option value="" {if empty($_GPC['offerTags'])}selected{/if}>选择货源</option>
                        <option value="72514" {if $_GPC['offerTags'] == 72514}selected{/if}>进口货源</option>
                    </select>
                </span>
                <input style="width:80px;height:30px;border:1px solid #ccc;text-align:center" type="text" name='priceStart' value="{$_GPC['priceStart']}" placeholder="最低价"> -
                <input style="width:80px;height:30px;border:1px solid #ccc;text-align:center" type="text" name='priceEnd' value="{$_GPC['priceEnd']}" placeholder="最高价">

                <input type="text" style="width:278px;float:right" class="input-sm form-control" name='keyword' value="{$_GPC['keyword']}" placeholder="ID/名称/编号/条码{if $merch_plugin}/商户名称{/if}">


                <span class="input-group-btn">
                    <button class="btn btn-primary" type="submit"> 搜索</button>
                </span>
            </div>
        </div>
    </form>
    {if count($list)>0 && cv('goods.main')}
    <div class="row">
        <div class="col-md-12">
            <div class="page-table-header">
                <input type='checkbox' />
                <div class="btn-group">
                    商品售价公式 
                    <input style="height:30px;border:1px solid #efefef;margin-left:10px" class="n_price" type="text"  placeholder="n+(金额)"  >
                    <input style="height:30px;padding:0px 10px" class="price_set_all btn-primary" type="button" value="批量设置">
                    <input style="height:30px;padding:0px 10px" class="goods_get_all btn-primary" type="button" value="批量入库">
                </div>
            </div>
            <table class="table table-responsive">
                <thead class="navbar-inner">
                <tr>
                    <th style="width:25px;"></th>
                    <th style="width:80px;text-align:center;">排序</th>
                    <th style="width:80px;">商品</th>
                    <th style="">&nbsp;</th>
                    <th style="">商品分类</th>
                    <th style="width: 100px;">入货价（&yen;）</th>
                    <th style="width: 100px;">超买价（&yen;）</th>
                    <th style="width: 80px;">是否有效</th>
                    <th style="width: 80px;">销量</th>
                    <th style="width: 80px;">出售价</th>
                    <!--<th style="width: 200px;">利润空间</th>-->
                    <th  style="width:80px;" >标签</th>
                    <!--<th>属性</th>-->
                    <th style="width: 120px;">操作</th>
                </tr>

                </thead>
                <tbody>
                <!--aa-->
                {loop $list $item}
                <tr>
                    <td>
                        <input class="offerId" type='checkbox' name="goods_id[]"  value="{$item['offerId']}"/>
                    </td>
                    <td style='text-align:center;'>
                        {ifp 'goods.edit'}
                        <a href='javascript:;' data-toggle='ajaxEdit' data-href="{php echo webUrl('goods/change',array('type'=>'displayorder','id'=>$item['id']))}" >{$item['displayorder']}</a>
                        <i class="icow icow-weibiaoti-- " data-toggle="ajaxEdit2"></i>
                        {else}
                        {$item['displayorder']}
                        {/if}
                    </td>
                    <td>
                        <a href="https://detail.1688.com/offer/{$item['offerId']}.html" target="_blank"><img src="{$item['imgUrl']}" style="width:72px;height:72px;padding:1px;border:1px solid #efefef;margin: 7px 0" onerror="this.src='../addons/ewei_shopv2/static/images/nopic.png'" /></a>
                    </td>
                    <td class='full' >
                        <span style="display: block;width: 100%;">{$item['title']}</span>
                    </td>
                    <td class="category_list">
                        <select id="cates"  name='cates[]' class="form-control select2" style='width:180px;' multiple='' >
                            {loop $category $c}
                            <option class="category_option" value="{$c['id']}" {if is_array($item['cates']) &&  in_array($c['id'],$item['cates'])}selected{/if} >{$c['name']}</option>
                            {/loop}
                        </select>
                        <input type="text" class="category category_ids" value="">
                    </td>
                    <td class="currentPrice">{$item['currentPrice']}</td>
                    <td class="superBuyerPrice">{$item['superBuyerPrice']}</td>
                    <td>{php echo $item['enable']?是:否}</td>
                    <td>{$item['soldOut']}</td>
                    <td class="price_set_one"><input style="height:30px;border:1px solid #efefef;margin-left:10px" type="text"  placeholder="n+(金额)"   value="{$item['price']}"></td>
                    <!--<td>{$item['profit']}</td>-->
                    <td  style="overflow:visible;">
                        {loop $item['offerTags'] $i}
                        {$i}<br>
                        {/loop}

                    </td>
                    <td  style="overflow:visible;position:relative">
                        {if $item['status'] == -1}
                        <span class="offer_id offer_{$item['offerId']}" onclick="onclick_offer(this)" data-offer-id="{$item['offerId']}" style="    background: #47b1ff;color: #fff;padding: 3px 6px;border-radius: 2px;">关注商品</span>
                        {else if $item['status'] == 0}
                        <span class="offer_id offer_{$item['offerId']}" onclick="onclick_offer(this)" data-offer-id="{$item['offerId']}" style="    background: #47b1ff;color: #fff;padding: 3px 6px;border-radius: 2px;">关注商品</span><br>已下架关注中
                        {else if $item['status'] == 1}
                        <span class="offer_id offer_{$item['offerId']}" onclick="onclick_offer(this)" data-offer-id="{$item['offerId']}" style="    background: #47b1ff;color: #fff;padding: 3px 6px;border-radius: 2px;">关注商品</span><br>已上架关注中
                        {/if}
                    </td>
                </tr>
                {if !empty($item['merchname']) && $item['merchid'] > 0}
                <tr style="background: #f9f9f9">
                    <td colspan='{if $goodsfrom=='cycle'}9{else}10{/if}' style='text-align: left;border-top:none;padding:5px 0;' class='aops'>
                    <span class="text-default" style="margin-left: 10px;">商户名称：</span><span class="text-info">{$item['merchname']}</span>
                    </td>
                </tr>
                {/if}
                {/loop}
                </tbody>
                <tfoot>
                <tr>
                    <td><input type="checkbox"></td>
                    <td    {if $goodsfrom!='cycle'}colspan="4"{else}colspan="3" {/if}>
                    <div class="btn-group">
                        {ifp 'goods.edit'}
                        {if $_GPC['goodsfrom']=='sale'}
                        <button class="btn btn-default btn-sm  btn-operation" type="button" data-toggle='batch'  data-href="{php echo webUrl('goods/status',array('status'=>0))}">
                            <i class='icow icow-xiajia3'></i> 下架</button>
                        {/if}
                        {if $_GPC['goodsfrom']=='stock'}
                        <button class="btn btn-default btn-sm  btn-operation" type="button" data-toggle='batch' data-href="{php echo webUrl('goods/status',array('status'=>1))}">
                            <i class='icow icow-shangjia2'></i> 上架</button>
                        {/if}
                        {/if}

                        {if $_GPC['goodsfrom']=='cycle'}
                        {ifp 'goods.delete1'}
                        <button class="btn btn-default btn-sm  btn-operation" type="button" data-toggle='batch-remove' data-confirm="如果商品存在购买记录，会无法关联到商品, 确认要彻底删除吗?" data-href="{php echo webUrl('goods/delete1')}">
                            <i class='icow icow-shanchu1'></i> 彻底删除</button>
                        {/if}

                        {ifp 'goods.restore'}
                        <button class="btn btn-default btn-sm  btn-operation" type="button" data-toggle='batch-remove' data-confirm="确认要恢复?" data-href="{php echo webUrl('goods/restore')}">
                            <i class='icow icow-huifu1'></i> 恢复到仓库</button>
                        {/if}

                        {else}
                        {ifp 'goods.delete'}
                        <button class="btn btn-default btn-sm  btn-operation" type="button" data-toggle='batch-remove' data-confirm="确认要彻底删除吗?" data-href="{php echo webUrl('goods/delete1')}">
                            <i class='icow icow-shanchu1'></i> 彻底删除</button>
                        {/if}
                        {/if}
                    </div>
                    </td>
                    <td colspan="5" style="text-align: right">
                        {$pager}
                    </td>
                </tr>
                </tfoot>
            </table>
        </div>
    </div>
    {else}
    <div class="panel panel-default">
        <div class="panel-body empty-data">暂时没有任何商品!</div>
    </div>
    {/if}
</div>

<div  class="page-loading-inner dn"  style="    position: absolute;
    background: rgba(255,255,255,0.8);
    left: 20px;
    top: 65px;
    right: 20px;
    bottom: 0;
    z-index: 99;">
            <div class="sk-three-bounce">
                <div class="sk-child sk-bounce1"></div>
                <div class="sk-child sk-bounce2"></div>
                <div class="sk-child sk-bounce3"></div>
            </div>
        </div>

{template 'goods/batchcates'}

{template '_footer'}

<script>
    // 1688关注
    
    function onclick_offer(obj) {
        var offer_id = $(obj).attr('data-offer-id');
        var category_ids = '';
        var select = $(obj).parents('tr').children('.category_list').children('select').children('option:selected');
        var price = $(obj).parents('tr').children('.price_set_one').children('input').attr('value');
        var formula = $('.n_price').val();



        select.each(function () {
            category_ids += $(this).val()+',';
        })



        category_ids=category_ids.slice(0, -1);

        console.log(price);


        $.ajax({
            type:'POST',
            url:"{php echo webUrl('goods/albb/follow')}",
            dataType:'json',
            data:{
                offer_id:offer_id,
                category_ids:category_ids,
                price:price,
                formula:formula,
            },
            success:function(data){
                if(data.status == 1){
                    alert(data.result.message);
                }else{
                    alert(data.result.message);
                }
            },
        })
    }
    



    //批量设置金额公式
    $('.price_set_all').click(function(){
        var price = $('.n_price').val();

        var tag='n';
        if(price.indexOf(tag)==-1){
            alert('请输入带有“n”的计算公式 （金额）');
        }
        var offerId = $('.offerId:checked');
        offerId.each(function(){
            var currentPrice = $(this).parents('tr').children('.currentPrice').text();
            var superBuyerPrice = $(this).parents('tr').children('.superBuyerPrice').text();
            var price_set_one = $(this).parents('tr').children('.price_set_one');
            price_set_one.children('input').attr('value',price );
        })

    })

    //批量导入商品
    $('.goods_get_all').click(function(){
        var offerId = $('.offerId:checked');



        offerId.each(function(){

            var ID = $(this).val();

            $('.offer_'+ID).click();
            console.log(ID)
//            var price_set_one = $(this).val();

        })

    })


</script>
<script>
    //获得分类标签
    // var length = $('#catetag').children().length;
    // if (length >10){
    //     for (var i=2;i<length;i++)
    //     {
    //         $('#catetag').children().eq(i).hide();
    //     }
    //     $('#catetag').append('...等');
    // }
    //显示批量分类
    $('#batchcatesbut').click(function () {
        $('#batchcates').show();
    })

    //关闭批量分类
    $('.modal-header .close').click(function () {
        $('#batchcates').hide();
    })

    // 取消批量分类
    $('.modal-footer .btn.btn-default').click(function () {
        $('#batchcates').hide();
    })

    //确认
    $('.modal-footer .btn.btn-primary').click(function () {
        var selected_checkboxs = $('.table-responsive tbody tr td:first-child [type="checkbox"]:checked');
        var goodsids = selected_checkboxs.map(function () {
            return $(this).val()
        }).get();

        var cates=$('#cates').val();
        var iscover=$('input[name="iscover"]:checked').val();
        $.post(biz.url('goods/ajax_batchcates'),{'goodsids':goodsids,'cates': cates,'iscover':iscover}, function (ret) {
            if (ret.status == 1) {
                $('#batchcates').hide();
                tip.msgbox.suc('修改成功');
                window.location.reload();
                return
            } else {
                tip.msgbox.err('修改失败');
            }
        }, 'json');
    })

    $(document).on("click", '[data-toggle="ajaxEdit2"]',
        function (e) {
            var _this = $(this)
            $(this).addClass('hidden')
            var obj = $(this).parent().find('a'),
                url = obj.data('href') || obj.attr('href'),
                data = obj.data('set') || {},
                html = $.trim(obj.text()),
                required = obj.data('required') || true,
                edit = obj.data('edit') || 'input';
            var oldval = $.trim($(this).text());
            e.preventDefault();

            submit = function () {
                e.preventDefault();
                var val = $.trim(input.val());
                if (required) {
                    if (val == '') {
                        tip.msgbox.err(tip.lang.empty);
                        return;
                    }
                }
                if (val == html) {
                    input.remove(), obj.html(val).show();
                    //obj.closest('tr').find('.icow').css({visibility:'visible'})
                    return;
                }
                if (url) {
                    $.post(url, {
                        value: val
                    }, function (ret) {

                        ret = eval("(" + ret + ")");
                        if (ret.status == 1) {
                            obj.html(val).show();

                        } else {
                            tip.msgbox.err(ret.result.message, ret.result.url);
                        }
                        input.remove();
                    }).fail(function () {
                        input.remove(), tip.msgbox.err(tip.lang.exception);
                    });
                } else {
                    input.remove();
                    obj.html(val).show();
                }
                obj.trigger('valueChange', [val, oldval]);
            },
                obj.hide().html('<i class="fa fa-spinner fa-spin"></i>');
            var input = $('<input type="text" class="form-control input-sm" style="width: 80%;display: inline;" />');
            if (edit == 'textarea') {
                input = $('<textarea type="text" class="form-control" style="resize:none;" rows=3 width="100%" ></textarea>');
            }
            obj.after(input);

            input.val(html).select().blur(function () {
                submit(input);
                _this.removeClass('hidden')

            }).keypress(function (e) {
                if (e.which == 13) {
                    submit(input);
                    _this.removeClass('hidden')
                }
            });

        })
</script>

<script>
    $(function(){

        $('#onekey_stock').click(function(){
            alert('该功能正在开发中');
            return false;
        });

        $('#batch_update').click(function(){
        	 $('.page-loading-inner').removeClass('dn');
            var id_array= [];
            $('input[name="goods_id[]"]:checked').each(function(){
                id_array.push($(this).val());
            });

            if(id_array.length == 0){
                alert('核对信息为空');
                return false;
            }
            console.log(id_array);
            $.ajax({
                type:'POST',
                url:"{php echo webUrl('goods/batch_update')}",
                dataType:'json',
                data:{ids:id_array},
                success:function(data){
                    if(data ==1){
                        alert('所选商品核对成功');
                        window.location.href = location.href;
                    }
                },
            })

        });

    });
</script>
